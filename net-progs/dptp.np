import device psa;
global DPTP_REQUEST : bit<8> = 2;
global DPTP_RESPONSE : bit<8> = 3;

packet dptp_pkt:ethernet(etherType:1234){
  magic : bit<16>;
  command : bit<8>;
  dptp_now : bit<64>;
  traffic_rate : bit<32>;
}


@ bmv2
snippet dptp_switch(){
  persistent dptp_ref : bit<64>;
  persistent switch_id : bit<64>;
  if (dptp_pkt.command == 2) {
    dptp_pkt.dptp_now = dptp_ref + psa.timestamp_egress;
    dptp_pkt.command = 3;

  }


}
